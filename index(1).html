<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sarasavi Library Management System - Vishuu</title>
    <style>
        :root { --primary: #003366; --secondary: #c0392b; --accent: #f39c12; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: var(--bg); color: #333; }
        nav { background: var(--primary); padding: 15px; color: white; display: flex; justify-content: center; gap: 20px; font-weight: bold; position: sticky; top: 0; z-index: 1000; }
        nav div { cursor: pointer; padding: 5px 15px; border-radius: 5px; transition: 0.3s; }
        nav div:hover { background: rgba(255,255,255,0.2); }
        .active-nav { border-bottom: 3px solid var(--accent); }
        
        .container { padding: 40px; max-width: 1100px; margin: auto; }
        .section { display: none; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .active { display: block; }
        
        /* Typography */
        h1, h2, h3 { color: var(--primary); border-bottom: 2px solid var(--accent); padding-bottom: 10px; }
        .hero { text-align: center; background: linear-gradient(135deg, #003366 0%, #006699 100%); color: white; padding: 60px; border-radius: 15px; margin-bottom: 30px; }
        
        /* Forms */
        .form-group { margin-bottom: 15px; display: flex; flex-direction: column; gap: 5px; }
        input, select, textarea { padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        button { padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #002244; transform: translateY(-2px); }
        .btn-red { background: var(--secondary); }
        
        /* Table & Grid */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .book-card { border: 1px solid #eee; padding: 20px; border-radius: 10px; background: #fff; text-align: center; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .book-card:hover { transform: scale(1.03); }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; margin-top: 5px; font-weight: bold; }
        .badge-ref { background: #e74c3c; color: white; }
        .badge-bor { background: #2ecc71; color: white; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border-bottom: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: #f2f2f2; color: var(--primary); }
    </style>
</head>
<body>

<nav>
    <div onclick="showSection('home')" id="nav-home">Home</div>
    <div onclick="showSection('visit')" id="nav-visit">Visit</div>
    <div onclick="showSection('loan')" id="nav-loan">Book Loan</div>
    <div onclick="showSection('staff')" id="nav-staff">Staff</div>
    <div onclick="showSection('admin')" id="nav-admin">Librarian</div>
</nav>

<div class="container">
    <div id="home" class="section active">
        <div class="hero">
            <h1>Sarasavi පුස්තකාල කළමනාකරණ පද්ධතිය</h1>
            <p>දැනුමේ පිපාසය සංසිඳුවන, ඔබගේ විශ්වාසවන්ත පුස්තකාලය.</p>
            <div style="margin-top: 20px;">
                <button onclick="showSection('visit')" style="background: var(--accent);">දැන්ම පොත් බලන්න</button>
            </div>
        </div>
        <div class="card-grid">
            <div class="book-card"><h3>Visit</h3><p>ඕනෑම අයෙකුට පොත් නාමාවලිය නැරඹිය හැකිය.</p></div>
            <div class="book-card"><h3>Members</h3><p>ලියාපදිංචි වී පොත් 5ක් දක්වා ණයට ගන්න.</p></div>
            <div class="book-card"><h3>Staff</h3><p>නව පොත් ඇතුළත් කිරීමේ පහසුකම.</p></div>
        </div>
    </div>

    <div id="visit" class="section">
        <h2>පොත් නාමාවලිය (Public Catalogue)</h2>
        <div class="form-group">
            <label>වර්ගය අනුව සොයන්න:</label>
            <select id="visitFilter" onchange="displayPublicBooks(this.value)"></select>
        </div>
        <div id="publicBookGrid" class="card-grid"></div>
    </div>

    <div id="loan" class="section">
        <div id="authArea">
            <h2>Member Login</h2>
            <div class="form-group">
                <input type="text" id="loginNIC" placeholder="ඔබේ NIC අංකය ඇතුළත් කරන්න">
                <button onclick="memberLogin()">Login</button>
            </div>
            <hr>
            <h3>නව සාමාජිකයෙකු වන්න (Sign Up)</h3>
            <div class="form-group">
                [span_4](start_span)<input type="text" id="regName" placeholder="සම්පූර්ණ නම[span_4](end_span)">
                [span_5](start_span)<input type="text" id="regNIC" placeholder="NIC අංකය[span_5](end_span)">
                <select id="regSex"><option>Male</option><option>Female</option></select>
                [span_6](start_span)<textarea id="regAddr" placeholder="ලිපිනය[span_6](end_span)"></textarea>
                <button onclick="memberRegister()" style="background:var(--accent)">Register</button>
            </div>
        </div>
        <div id="memberDashboard" style="display:none;">
            <h2 id="memWelcome">ආයුබෝවන්!</h2>
            <div style="background: #eef; padding: 15px; border-radius: 8px;">
                [span_7](start_span)<p>ඔබ ලබාගෙන ඇති පොත් ගණන: <b id="borrowCount">0</b> / 5[span_7](end_span)</p>
            </div>
            <h3>පොත් ණයට ගැනීම</h3>
            <div id="memberBookGrid" class="card-grid"></div>
            <button class="btn-red" onclick="logout()" style="margin-top:20px;">Logout</button>
        </div>
    </div>

    <div id="staff" class="section">
        <h2>Library Staff Panel</h2>
        <div id="staffAuth">
            <input type="password" id="staffPass" placeholder="Staff Password">
            <button onclick="staffLogin('staff')">Login</button>
        </div>
        <div id="staffPanel" style="display:none;">
            [span_8](start_span)<h3>නව පොත් ඇතුළත් කිරීම[span_8](end_span)</h3>
            <div class="form-group">
                [span_9](start_span)<label>පොතේ මාතෘකාව[span_9](end_span):</label><input type="text" id="bTitle">
                [span_10](start_span)<label>වර්ගීකරණය (Category)[span_10](end_span):</label><select id="bCatSelect"></select>
                [span_11](start_span)<label>පිටපත් ගණන (උපරිම 10)[span_11](end_span):</label><input type="number" id="bCopies" max="10" min="1" value="1">
                [span_12](start_span)<label>පොතේ තත්ත්වය[span_12](end_span):</label>
                <select id="bType">
                    <option value="Borrowable">Borrowable (ණයට ගත හැක)</option>
                    <option value="Reference">Reference Only (පරිශීලනයට පමණි)</option>
                </select>
                <button onclick="addNewBook()">පද්ධතියට එක් කරන්න</button>
            </div>
        </div>
    </div>

    <div id="admin" class="section">
        <h2>Librarian Panel</h2>
        <div id="adminAuth">
            <input type="password" id="adminPass" placeholder="Admin Password">
            <button onclick="staffLogin('admin')">Login</button>
        </div>
        <div id="adminPanel" style="display:none;">
            <h3>පද්ධති වාර්තා</h3>
            <div id="adminStats"></div>
            <table id="loanTable">
                <thead><tr><th>පොත</th><th>සාමාජිකයා</th><th>දිනය</th><th>තත්ත්වය</th></tr></thead>
                <tbody id="loanEntries"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 20 Categories
    const categories = ["Fiction", "Science", "History", "Technology", "Biography", "Medicine", "Arts", "Law", "Philosophy", "Religion", "Geography", "Mathematics", "Engineering", "Business", "Literature", "Psychology", "Languages", "Children", "Poetry", "Educational"];

    [span_13](start_span)// Initialize Data[span_13](end_span)
    let books = JSON.parse(localStorage.getItem('lib_books')) || [];
    let members = JSON.parse(localStorage.getItem('lib_members')) || [];
    let loggedMember = null;

    // Load Initial Data
    window.onload = () => {
        populateCategories();
        if(books.length === 0) seedData();
        displayPublicBooks('All');
    };

    function populateCategories() {
        const selects = ['visitFilter', 'bCatSelect'];
        selects.forEach(id => {
            const el = document.getElementById(id);
            if(id === 'visitFilter') el.innerHTML = '<option value="All">සියලුම පොත්</option>';
            categories.forEach(c => el.innerHTML += `<option value="${c}">${c}</option>`);
        });
    }

    function seedData() {
        // Sample Books
        const samples = [
            { id: "F0001-1", title: "Madol Doova", category: "Fiction", type: "Borrowable", status: "Available" },
            { id: "S0002-1", title: "Cosmos", category: "Science", type: "Borrowable", status: "Available" },
            { id: "T0003-1", title: "Clean Code", category: "Technology", type: "Reference", status: "Available" }
        ];
        books = samples;
        localStorage.setItem('lib_books', JSON.stringify(books));
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('nav div').forEach(n => n.classList.remove('active-nav'));
        document.getElementById(id).classList.add('active');
        document.getElementById('nav-' + id).classList.add('active-nav');
    }

    // Member Logic
    function memberRegister() {
        const name = document.getElementById('regName').value;
        const nic = document.getElementById('regNIC').value;
        [span_14](start_span)if(!name || !nic) { alert("සියලු දත්ත ඇතුළත් කරන්න[span_14](end_span)"); return; }
        
        members.push({ name, nic, sex: document.getElementById('regSex').value, address: document.getElementById('regAddr').value, borrowed: [] });
        localStorage.setItem('lib_members', JSON.stringify(members));
        alert("ලියාපදිංචිය සාර්ථකයි! දැන් Login වන්න.");
    }

    function memberLogin() {
        const nic = document.getElementById('loginNIC').value;
        const user = members.find(m => m.nic === nic);
        if(user) {
            loggedMember = user;
            document.getElementById('authArea').style.display = 'none';
            document.getElementById('memberDashboard').style.display = 'block';
            document.getElementById('memWelcome').innerText = `ආයුබෝවන්, ${user.name}!`;
            updateMemberUI();
        } else { alert("සාමාජිකත්වය හමු නොවීය."); }
    }

    function updateMemberUI() {
        document.getElementById('borrowCount').innerText = loggedMember.borrowed.length;
        const grid = document.getElementById('memberBookGrid');
        grid.innerHTML = '';
        books.filter(b => b.status === 'Available' && b.type === 'Borrowable').forEach(b => {
            grid.innerHTML += `<div class="book-card">
                <b>${b.title}</b><br><small>${b.category}</small><br>
                <button onclick="borrowBook('${b.id}')" style="margin-top:10px;">ලබාගන්න</button>
            </div>`;
        });
    }

    function borrowBook(id) {
        [span_15](start_span)if(loggedMember.borrowed.length >= 5) { alert("උපරිම පොත් 5 සීමාව ඉක්මවා ඇත[span_15](end_span)"); return; }
        const book = books.find(b => b.id === id);
        book.status = 'Borrowed';
        loggedMember.borrowed.push(id);
        saveAll();
        updateMemberUI();
        [span_16](start_span)alert("පොත නිකුත් කළා. ආපසු දීමට සති 2ක කාලයක් ඇත[span_16](end_span).");
    }

    // Staff Logic
    function staffLogin(role) {
        const pass = document.getElementById(role + 'Pass').value;
        if(pass === '123') {
            document.getElementById(role + 'Auth').style.display = 'none';
            document.getElementById(role + 'Panel').style.display = 'block';
            if(role === 'admin') refreshAdmin();
        } else { alert("වැරදි මුරපදයක්."); }
    }

    function addNewBook() {
        const title = document.getElementById('bTitle').value;
        const cat = document.getElementById('bCatSelect').value;
        const copies = parseInt(document.getElementById('bCopies').value);
        const type = document.getElementById('bType').value;

        [span_17](start_span)if(copies > 10) { alert("එක් පොතකට උපරිම පිටපත් 10කි[span_17](end_span)"); return; }

        [span_18](start_span)// X9999 ID Logic[span_18](end_span)
        const classChar = cat.charAt(0).toUpperCase();
        const seq = Math.floor(1000 + Math.random() * 9000);
        
        for(let i = 1; i <= copies; i++) {
            books.push({ id: `${classChar}${seq}-${i}`, title, category: cat, type, status: 'Available' });
        }
        saveAll();
        alert(`${copies} පිටපත් පද්ධතියට එක් කළා.`);
    }

    function displayPublicBooks(filter) {
        const grid = document.getElementById('publicBookGrid');
        grid.innerHTML = '';
        const filtered = filter === 'All' ? books : books.filter(b => b.category === filter);
        filtered.forEach(b => {
            const badgeClass = b.type === 'Reference' ? 'badge-ref' : 'badge-bor';
            grid.innerHTML += `<div class="book-card">
                <b>${b.title}</b><br>
                <span class="badge ${badgeClass}">${b.type}</span><br>
                <small>ID: ${b.id}</small><br>
                <small>${b.status}</small>
            </div>`;
        });
    }

    function refreshAdmin() {
        const stats = document.getElementById('adminStats');
        stats.innerHTML = `මුළු පොත්: ${books.length} | සාමාජිකයන්: ${members.length}`;
    }

    function saveAll() {
        localStorage.setItem('lib_books', JSON.stringify(books));
        localStorage.setItem('lib_members', JSON.stringify(members));
    }

    function logout() {
        location.reload();
    }
</script>

</body>
</html>
